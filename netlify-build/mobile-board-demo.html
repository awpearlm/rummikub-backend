<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Game Board Demo</title>
    <link rel="stylesheet" href="css/mobile-foundation.css">
    <link rel="stylesheet" href="css/mobile-game-board.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a1a;
            color: #ffffff;
            overflow: hidden;
        }
        
        .demo-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .demo-header {
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 20px;
            text-align: center;
            font-size: 14px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .board-container {
            flex: 1;
            position: relative;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .demo-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 8px;
            font-size: 12px;
            z-index: 1001;
        }
        
        .demo-controls button {
            background: #4ecdc4;
            color: white;
            border: none;
            padding: 8px 12px;
            margin: 2px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
        }
        
        .demo-controls button:hover {
            background: #45b7aa;
        }
        
        .gesture-info {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 8px;
            font-size: 12px;
            max-width: 300px;
            z-index: 1001;
        }
        
        .gesture-log {
            max-height: 100px;
            overflow-y: auto;
            margin-top: 5px;
            font-family: monospace;
            font-size: 10px;
            line-height: 1.2;
        }
        
        .gesture-log div {
            margin: 2px 0;
            padding: 2px 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
        }
        
        @media screen and (orientation: landscape) {
            .demo-header {
                font-size: 12px;
                padding: 8px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="demo-header">
            <strong>Mobile Game Board Demo</strong><br>
            Touch gestures: Tap (select), Double-tap (reset view), Long press (context), Drag (move/pan), Pinch (zoom)
        </div>
        
        <div class="board-container" id="boardContainer">
            <div class="demo-controls">
                <button onclick="addRandomTile()">Add Tile</button>
                <button onclick="clearBoard()">Clear</button>
                <button onclick="resetView()">Reset View</button>
                <button onclick="toggleGestures()">Toggle Gestures</button>
            </div>
            
            <div class="gesture-info">
                <div><strong>Gesture Status:</strong></div>
                <div id="gestureStatus">Ready</div>
                <div><strong>Recent Events:</strong></div>
                <div class="gesture-log" id="gestureLog"></div>
            </div>
        </div>
    </div>

    <!-- Load dependencies -->
    <script src="js/mobile-ui/TouchManager.js"></script>
    <script src="js/mobile-ui/GestureRecognizer.js"></script>
    <script src="js/mobile-ui/SmartBoardPositioning.js"></script>
    <script src="js/mobile-ui/BoardGestureRecognizer.js"></script>
    <script src="js/mobile-ui/MobileGameBoard.js"></script>

    <script>
        class MobileBoardDemo {
            constructor() {
                this.gameBoard = null;
                this.tileCounter = 0;
                this.gesturesEnabled = true;
                
                this.init();
            }

            async init() {
                try {
                    // Initialize mobile game board
                    const container = document.getElementById('boardContainer');
                    this.gameBoard = new MobileGameBoard(container, {
                        touchEnabled: true,
                        dragDropEnabled: true,
                        visualFeedback: true
                    });
                    
                    // Setup event listeners
                    this.setupEventListeners();
                    
                    // Add some initial tiles
                    this.addInitialTiles();
                    
                    console.log('Mobile Board Demo initialized');
                    this.logGesture('Demo initialized');
                    
                } catch (error) {
                    console.error('Failed to initialize demo:', error);
                    this.logGesture(`Error: ${error.message}`);
                }
            }

            setupEventListeners() {
                if (!this.gameBoard) return;
                
                // Gesture events
                this.gameBoard.on('tileSelected', (data) => {
                    this.logGesture(`Tile selected: ${data.tile.number || 'J'}`);
                    this.updateGestureStatus('Tile Selected');
                });
                
                this.gameBoard.on('tileDoubleTapped', (data) => {
                    this.logGesture(`Tile double-tapped: ${data.tile.number || 'J'}`);
                    this.updateGestureStatus('Tile Double-Tapped');
                });
                
                this.gameBoard.on('tileLongPressed', (data) => {
                    this.logGesture(`Tile long-pressed: ${data.tile.number || 'J'}`);
                    this.updateGestureStatus('Tile Long-Pressed');
                });
                
                this.gameBoard.on('boardTapped', (data) => {
                    this.logGesture(`Board tapped at (${Math.round(data.position.x)}, ${Math.round(data.position.y)})`);
                    this.updateGestureStatus('Board Tapped');
                });
                
                this.gameBoard.on('boardDoubleTapped', (data) => {
                    this.logGesture('Board double-tapped - resetting view');
                    this.updateGestureStatus('Board Double-Tapped');
                });
                
                this.gameBoard.on('boardLongPressed', (data) => {
                    this.logGesture('Board long-pressed - context menu');
                    this.updateGestureStatus('Board Long-Pressed');
                });
                
                // Drag events
                this.gameBoard.on('tileDragStart', (data) => {
                    this.logGesture(`Tile drag started: ${data.tiles[0].number || 'J'}`);
                    this.updateGestureStatus('Dragging Tile');
                });
                
                this.gameBoard.on('tileDragComplete', (data) => {
                    const result = data.success ? 'placed' : 'returned';
                    this.logGesture(`Tile drag ${result}: ${data.tiles[0].number || 'J'}`);
                    this.updateGestureStatus(data.success ? 'Tile Placed' : 'Tile Returned');
                });
                
                this.gameBoard.on('boardPanStart', (data) => {
                    this.logGesture('Board pan started');
                    this.updateGestureStatus('Panning Board');
                });
                
                this.gameBoard.on('boardPanComplete', (data) => {
                    this.logGesture(`Board panned by (${Math.round(data.delta.x)}, ${Math.round(data.delta.y)})`);
                    this.updateGestureStatus('Board Panned');
                });
                
                // Zoom events
                this.gameBoard.on('boardZoom', (data) => {
                    this.logGesture(`Board zoom: ${data.zoom.toFixed(2)}x`);
                    this.updateGestureStatus(`Zooming: ${data.zoom.toFixed(2)}x`);
                });
                
                this.gameBoard.on('boardZoomComplete', (data) => {
                    this.logGesture(`Zoom complete: ${data.finalScale.toFixed(2)}x`);
                    this.updateGestureStatus('Zoom Complete');
                });
                
                // Positioning events
                this.gameBoard.on('boardPositioned', (data) => {
                    this.logGesture(`Board repositioned: ${data.reason || 'unknown'}`);
                });
                
                // Tile placement events
                this.gameBoard.on('tilesPlaced', (data) => {
                    this.logGesture(`${data.tiles.length} tile(s) placed on board`);
                });
            }

            addInitialTiles() {
                // Add some sample tiles to the board
                const sampleTiles = [
                    { id: 'tile1', number: 1, color: 'red', x: 100, y: 100 },
                    { id: 'tile2', number: 2, color: 'blue', x: 160, y: 100 },
                    { id: 'tile3', number: 3, color: 'black', x: 220, y: 100 },
                    { id: 'joker1', isJoker: true, x: 100, y: 180 },
                    { id: 'tile4', number: 7, color: 'orange', x: 300, y: 200 }
                ];
                
                sampleTiles.forEach(tile => {
                    this.gameBoard.placeTiles([tile], { x: tile.x / 50, y: tile.y / 50 });
                });
                
                this.tileCounter = sampleTiles.length;
            }

            addRandomTile() {
                this.tileCounter++;
                const colors = ['red', 'blue', 'black', 'orange'];
                const isJoker = Math.random() < 0.2;
                
                const tile = {
                    id: `tile${this.tileCounter}`,
                    number: isJoker ? null : Math.floor(Math.random() * 13) + 1,
                    color: isJoker ? null : colors[Math.floor(Math.random() * colors.length)],
                    isJoker: isJoker
                };
                
                const position = {
                    x: Math.floor(Math.random() * 10) + 2,
                    y: Math.floor(Math.random() * 8) + 2
                };
                
                this.gameBoard.placeTiles([tile], position);
                this.logGesture(`Added ${isJoker ? 'joker' : tile.number} tile`);
            }

            clearBoard() {
                if (this.gameBoard) {
                    this.gameBoard.clearBoard();
                    this.logGesture('Board cleared');
                    this.updateGestureStatus('Board Cleared');
                }
            }

            resetView() {
                if (this.gameBoard) {
                    this.gameBoard.resetBoardView();
                    this.logGesture('View reset');
                    this.updateGestureStatus('View Reset');
                }
            }

            toggleGestures() {
                this.gesturesEnabled = !this.gesturesEnabled;
                
                if (this.gameBoard) {
                    this.gameBoard.setGestureOptions({
                        enablePinchZoom: this.gesturesEnabled,
                        enableDoubleTap: this.gesturesEnabled,
                        enableLongPress: this.gesturesEnabled
                    });
                }
                
                this.logGesture(`Gestures ${this.gesturesEnabled ? 'enabled' : 'disabled'}`);
                this.updateGestureStatus(`Gestures ${this.gesturesEnabled ? 'Enabled' : 'Disabled'}`);
            }

            updateGestureStatus(status) {
                const statusElement = document.getElementById('gestureStatus');
                if (statusElement) {
                    statusElement.textContent = status;
                    
                    // Clear status after 2 seconds
                    setTimeout(() => {
                        statusElement.textContent = 'Ready';
                    }, 2000);
                }
            }

            logGesture(message) {
                const logElement = document.getElementById('gestureLog');
                if (logElement) {
                    const timestamp = new Date().toLocaleTimeString();
                    const logEntry = document.createElement('div');
                    logEntry.textContent = `${timestamp}: ${message}`;
                    
                    logElement.appendChild(logEntry);
                    
                    // Keep only last 10 entries
                    while (logElement.children.length > 10) {
                        logElement.removeChild(logElement.firstChild);
                    }
                    
                    // Scroll to bottom
                    logElement.scrollTop = logElement.scrollHeight;
                }
                
                console.log(`Gesture: ${message}`);
            }
        }

        // Global functions for demo controls
        let demo;

        function addRandomTile() {
            if (demo) demo.addRandomTile();
        }

        function clearBoard() {
            if (demo) demo.clearBoard();
        }

        function resetView() {
            if (demo) demo.resetView();
        }

        function toggleGestures() {
            if (demo) demo.toggleGestures();
        }

        // Initialize demo when page loads
        document.addEventListener('DOMContentLoaded', () => {
            demo = new MobileBoardDemo();
        });

        // Handle orientation changes
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                if (demo && demo.gameBoard) {
                    demo.gameBoard.handleResize();
                    demo.logGesture('Orientation changed');
                }
            }, 100);
        });
    </script>
</body>
</html>